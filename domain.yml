version: "3.1"

intents:
  - greet
  - goodbye
  - mood_great
  - mood_unhappy
  - bot_challenge
  - add_contact
  - ask_sentiment
  - check_scam
  - crypto_topic
  - share_expertise
  - mention_crypto
  - nlu_fallback
    # Existing intents
  - affirm
  - deny
  - inform
  - cancel
  - help
  - out_of_scope
  
  # New supporting intents for contact_add_request
  - provide_contact_name
  - provide_wallet_address
  - provide_crypto_network
  - request_clarification
  - restart
  - confirm_contact_details
  - ask_validation_status
  - continue_process
  - go_back
  - context_switch
  - ask_save_progress

  - contact_add_request

responses:
  # Basic greeting and introduction
  utter_cheer_up:
  - text: "Here is something to cheer you up:"
    image: "https://i.imgur.com/nGF1K8f.jpg"

  utter_did_that_help:
  - text: "Did that help you?"

  utter_happy:
  - text: "Great, carry on!"

  utter_goodbye:
  - text: "Bye"

  utter_iamabot:
  - text: "I am a bot, powered by Rasa."
  
  utter_add_contact_ask_name:
  - text: "Sure! What name would you like to save for this contact?"
  
  utter_add_contact_ask_address:
  - text: "Great! Now please provide the wallet address you want to save."
  
  # New responses for CryptoBERT features
  utter_investment_info:
  - text: "Investing in cryptocurrencies can offer high returns but also comes with significant risks. Remember to diversify your portfolio and only invest what you can afford to lose."
  
  utter_technical_info:
  - text: "Blockchain is a distributed ledger that stores data in blocks that are linked together. Each block contains a record of transactions and a reference to the previous block."
  
  utter_security_tips:
  - text: "Always protect your private keys, use two-factor authentication, and be cautious of phishing attempts. Consider using a hardware wallet for large investments."
  
  utter_ask_crypto_description:
  - text: "Can you describe that cryptocurrency project in more detail?"
  
  utter_ask_expertise_level:
  - text: "How much experience do you have with cryptocurrencies?"
  
  utter_default:
  - text: "I'm not sure I understand. Could you rephrase that?"
  - text: "I didn't catch that. Can you say it differently?"
  - text: "I'm having trouble understanding. Could you try another way?"


actions:
  - action_validate_wallet_address
  - action_reset_contact_slots
  - action_analyze_sentiment
  - action_detect_scam
  - action_classify_topic
  - action_update_user_expertise
  - action_extract_crypto_entities
  - action_handle_context_switch
  - action_ask_crypto_clarification
  
entities:
  - crypto_description
  - continue_flow
  - switch_context
  - contact_add_entity_name
  - contact_add_entity_crypto_network
  - contact_add_entity_wallet_address

slots:
  contact_add_entity_name:
    type: text
    mappings:
      - type: from_entity
        entity: contact_add_entity_name
    influence_conversation: true
    
  contact_add_entity_crypto_network:
    type: text
    mappings:
      - type: from_entity
        entity: contact_add_entity_crypto_network
    influence_conversation: true
    
  contact_add_entity_wallet_address:
    type: text
    mappings:
      - type: from_entity
        entity: contact_add_entity_wallet_address
    influence_conversation: true

  crypto_abbreviation:
    type: text
    mappings:
      - type: custom
    
  # Slot để kiểm soát luồng
  contact_exists:
    type: bool
    influence_conversation: true
    mappings:
    - type: custom
    
  valid_address:
    type: bool
    influence_conversation: true
    mappings:
    - type: custom

  address_valid:
    type: bool
    influence_conversation: true
    mappings:
    - type: custom
  
  # New slots for CryptoBERT features
  sentiment:
    type: text
    influence_conversation: true
    mappings:
    - type: custom
  
  sentiment_confidence:
    type: float
    influence_conversation: false
    mappings:
    - type: custom
  
  crypto_description:
    type: text
    influence_conversation: true
    mappings:
    - type: from_text
  
  scam_probability:
    type: float
    influence_conversation: false
    mappings:
    - type: custom
  
  query_topic:
    type: text
    influence_conversation: true
    mappings:
    - type: custom
  
  expertise_level:
    type: text
    influence_conversation: true
    mappings:
    - type: custom
  
  mentioned_tokens:
    type: list
    influence_conversation: true
    mappings:
    - type: custom
  
  mentioned_blockchains:
    type: list
    influence_conversation: true
    mappings:
    - type: custom
    
  active_context:
    type: text
    influence_conversation: true
    mappings:
    - type: custom

  validation_attempts:
    type: float
    influence_conversation: true
    mappings:
      - type: custom
  
  network_address_mismatch:
    type: bool
    influence_conversation: true
    mappings:
      - type: custom
  
  multiple_networks_detected:
    type: bool
    influence_conversation: true
    mappings:
      - type: custom
  
  unsupported_cryptocurrency:
    type: bool
    influence_conversation: true
    mappings:
      - type: custom
  
  # Context switching and workflow management slots
  contact_flow_active:
    type: bool
    influence_conversation: true
    mappings:
      - type: custom
  
  contact_last_active_state:
    type: text
    influence_conversation: false  # Không ảnh hưởng đến luồng hội thoại trực tiếp
    mappings:
      - type: custom
  
  previous_context:
    type: text
    influence_conversation: true
    mappings:
      - type: custom
  
  previous_form_state:
    type: text
    influence_conversation: false  # Chỉ dùng để lưu trữ, không ảnh hưởng đến dự đoán
    mappings:
      - type: custom

forms:
  add_contact_form:
    required_slots:
      - contact_add_entity_name
      - contact_add_entity_crypto_network
      - contact_add_entity_wallet_address

imports:
  - data/contact/contact_nlu.yml
  - data/contact/contact_responses.yml
  - data/contact/contact_rules.yml
  - data/contact/contact_stories.yml
  - data/common/crypto_synonym_nlu.yml

session_config:
  session_expiration_time: 60
  carry_over_slots_to_new_session: true